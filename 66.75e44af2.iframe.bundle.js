"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[66],{"./nodes/EquationComponent.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EquationComponent});var LexicalComposerContext_prod=__webpack_require__("../node_modules/.pnpm/@lexical+react@0.15.0_react-dom@18.3.1_react@18.3.1_yjs@13.6.15/node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),LexicalUtils_prod=__webpack_require__("../node_modules/.pnpm/@lexical+utils@0.15.0/node_modules/@lexical/utils/LexicalUtils.prod.mjs"),Lexical_prod=__webpack_require__("../node_modules/.pnpm/lexical@0.15.0/node_modules/lexical/Lexical.prod.mjs"),react=__webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),react_error_boundary_esm=__webpack_require__("../node_modules/.pnpm/react-error-boundary@4.0.13_react@18.3.1/node_modules/react-error-boundary/dist/react-error-boundary.esm.js");function EquationEditor(_ref,forwardedRef){let{equation,inline,setEquation}=_ref;const onChange=event=>{setEquation(event.target.value)};return inline&&forwardedRef instanceof HTMLInputElement?react.createElement("span",{className:"EquationEditor_inputBackground"},react.createElement("span",{className:"EquationEditor_dollarSign"},"$"),react.createElement("input",{autoFocus:!0,className:"EquationEditor_inlineEditor",onChange,ref:forwardedRef,value:equation}),react.createElement("span",{className:"EquationEditor_dollarSign"},"$")):react.createElement("div",{className:"EquationEditor_inputBackground"},react.createElement("span",{className:"EquationEditor_dollarSign"},"$$\n"),react.createElement("textarea",{className:"EquationEditor_blockEditor",onChange,ref:forwardedRef,value:equation}),react.createElement("span",{className:"EquationEditor_dollarSign"},"\n$$"))}const ui_EquationEditor=(0,react.forwardRef)(EquationEditor);var KatexRenderer=__webpack_require__("./ui/KatexRenderer.tsx"),EquationNode=__webpack_require__("./nodes/EquationNode.tsx");function EquationComponent(_ref){let{equation,inline,nodeKey}=_ref;const[editor]=(0,LexicalComposerContext_prod.DF)(),[equationValue,setEquationValue]=(0,react.useState)(equation),[showEquationEditor,setShowEquationEditor]=(0,react.useState)(!1),inputRef=(0,react.useRef)(null),onHide=(0,react.useCallback)((restoreSelection=>{setShowEquationEditor(!1),editor.update((()=>{const node=(0,Lexical_prod.ns)(nodeKey);(0,EquationNode.R_)(node)&&(node.setEquation(equationValue),restoreSelection&&node.selectNext(0,0))}))}),[editor,equationValue,nodeKey]);return(0,react.useEffect)((()=>{showEquationEditor||equationValue===equation||setEquationValue(equation)}),[showEquationEditor,equation,equationValue]),(0,react.useEffect)((()=>showEquationEditor?(0,LexicalUtils_prod.Sd)(editor.registerCommand(Lexical_prod.Mv,(payload=>{const activeElement=document.activeElement;return inputRef.current!==activeElement&&onHide(),!1}),Lexical_prod.Wg),editor.registerCommand(Lexical_prod.Q$,(payload=>{const activeElement=document.activeElement;return inputRef.current===activeElement&&(onHide(!0),!0)}),Lexical_prod.Wg)):editor.registerUpdateListener((_ref2=>{let{editorState}=_ref2;editorState.read((()=>{const selection=(0,Lexical_prod.vJ)();return(0,Lexical_prod.RT)(selection)&&selection.has(nodeKey)&&1===selection.getNodes().length}))&&setShowEquationEditor(!0)}))),[editor,nodeKey,onHide,showEquationEditor]),react.createElement(react.Fragment,null,showEquationEditor?react.createElement(ui_EquationEditor,{equation:equationValue,inline,ref:inputRef,setEquation:setEquationValue}):react.createElement(react_error_boundary_esm.tH,{fallback:null,onError:e=>editor._onError(e)},react.createElement(KatexRenderer.A,{equation:equationValue,inline,onDoubleClick:()=>setShowEquationEditor(!0)})))}try{EquationComponent.displayName="EquationComponent",EquationComponent.__docgenInfo={description:"",displayName:"EquationComponent",props:{equation:{defaultValue:null,description:"",name:"equation",required:!0,type:{name:"string"}},inline:{defaultValue:null,description:"",name:"inline",required:!0,type:{name:"boolean"}},nodeKey:{defaultValue:null,description:"",name:"nodeKey",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/nodes/EquationComponent.tsx#EquationComponent"]={docgenInfo:EquationComponent.__docgenInfo,name:"EquationComponent",path:"src/nodes/EquationComponent.tsx#EquationComponent"})}catch(__react_docgen_typescript_loader_error){}}}]);